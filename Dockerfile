FROM docker.io/node:20.12.2 as build-front

WORKDIR /app
COPY ./front /app
RUN npm ci
RUN npm run build

FROM docker.io/golang:1.20 AS build-api

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY ./ /app/
COPY --from=build-front /app/static /app/static

RUN CGO_ENABLED=1 GOOS=linux go build -o /cve-manager

FROM docker.io/debian:12.5-slim

COPY --from=build-api /cve-manager /cve-manager

EXPOSE 8080

CMD ["/cve-manager"]
