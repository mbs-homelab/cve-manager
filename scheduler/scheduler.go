package scheduler

import (
	"cve-manager/nist"
	"log"
	"time"
)

func RegisterNewWatcher(cpe string) {
	log.Printf("Regsitering new watcher for %s", cpe)
	scheduleTask(60*time.Second, func() {
		nist.GetCves(cpe)
	})
}

func scheduleTask(interval time.Duration, function func()) *time.Ticker {
	ticker := time.NewTicker(interval)
	quit := make(chan struct{})
	go func() {
		for {
			select {
			case <-ticker.C:
				ticker.Stop()
				log.Printf("Invoking function")
				function()
				ticker.Reset(interval)
			case <-quit:
				log.Printf("Stopping scheduler")
				ticker.Stop()
				return
			}
		}
	}()
	return ticker
}
