import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';
import { Cpe } from '../../../../api/backend/models/cpe.model';
import { CpeService } from '../../../../api/backend/services/cpe.service';

@Injectable()
export class CpesTableService {

    public readonly currentData$: Observable<Cpe[]>;

    public readonly pending$: Observable<boolean>;

    private readonly currentData$$: BehaviorSubject<Cpe[]> = new BehaviorSubject<Cpe[]>([]);

    private readonly pending$$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);

    constructor(
        private readonly cpeService: CpeService,
    ) {
        this.currentData$ = this.currentData$$.asObservable();
        this.pending$ = this.pending$$.asObservable();
    }

    public loadData(): void {
        this.pending$$.next(true);
        this.currentData$$.next([
            {
                name: 'Github Name',
                enabled: true,
                notify: true,
                tag: 'tag',
                cves: [],
                cpe: 'Github',
            }
        ])
        // this.pending$$.next(false);
        this.cpeService.getAllCpes().subscribe({
            next: (values) => {
                this.currentData$$.next(values);
            },
            error: (err) => {
                // TODO notifications
                console.error(err);
            },
            complete: () => {
                this.pending$$.next(false);
            }
        })
    }

}
