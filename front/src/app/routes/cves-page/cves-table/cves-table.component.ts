import { AsyncPipe, DatePipe, NgIf } from '@angular/common';
import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';
import { MatTableModule } from '@angular/material/table';
import { MatProgressSpinnerModule } from '@angular/material/progress-spinner';
import { Observable } from 'rxjs';
import { Cve } from '../../../../api/backend/models/cve.model';
import { CvesTableService } from './cves-table.service';
import { MatButtonModule } from '@angular/material/button';

@Component({
    selector: 'cve-cves-table',
    standalone: true,
    templateUrl: './cves-table.component.html',
    styleUrl: './cves-table.component.scss',
    changeDetection: ChangeDetectionStrategy.OnPush,
    imports: [
        NgIf,
        AsyncPipe,
        DatePipe,
        MatTableModule,
        MatProgressSpinnerModule,
        MatButtonModule
    ],
    providers: [
        CvesTableService,
    ]
})
export class CvesTableComponent implements OnInit {
    currentData$: Observable<Cve[]> = this.cvesTableService.currentData$;

    pending$: Observable<boolean> = this.cvesTableService.pending$;

    displayedColumns: (keyof Cve)[] = ['cpe', 'description', 'lastModified', 'url'];

    constructor(
        private readonly cvesTableService: CvesTableService,
    ) { }

    public ngOnInit(): void {
        this.cvesTableService.loadData();
    }
}
