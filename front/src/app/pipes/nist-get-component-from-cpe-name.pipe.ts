import { Pipe, PipeTransform } from '@angular/core';

type CpeComponent = 'vendor' | 'product' | 'version' | 'subversion';

const cpeComponentNameToIndex: Map<string, number> = new Map(
    [
        ['vendor', 3],
        ['product', 4],
        ['version', 5],
        ['subversion', 6]
    ]
)

@Pipe({
    name: 'nistGetComponentFromCpeName',
    standalone: true
})
export class NistGetComponentFromCpeNamePipe implements PipeTransform {

    transform(cpeName: string | null | undefined, cpeComponent: CpeComponent, fallbackText: string = '---'): string {
        if (!cpeName) {
            return fallbackText;
        }

        const parts: string[] = cpeName.split(':');

        const index: number | undefined = cpeComponentNameToIndex.get(cpeComponent);

        if (!index) {
            return fallbackText;
        }

        if (parts.length <= index + 1) {
            return fallbackText;
        }

        if (parts[index] === '*' || parts[index] === '-') {
            return fallbackText;
        }

        return parts[index];
    }

}
